{% extends "base.html" %}

{% block title %}Employees - Auto Invoice Generator{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Employee Management</h1>
            <a href="{{ url_for('employees.add_employee') }}" class="btn btn-primary">Add Employee</a>
        </div>
    </div>
</div>

{% if action == 'add' %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Add New Employee</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('employees.add_employee') }}">
                    <div class="mb-3">
                        <label for="name" class="form-label">Employee Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="salary_per_annum" class="form-label">Salary per Annum <span class="text-danger">*</span></label>
                        <input type="number" class="form-control" id="salary_per_annum" name="salary_per_annum" step="0.01" min="0" required>
                        <small class="form-text text-muted">Monthly salary will be auto-calculated</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="salary_per_month" class="form-label">Salary per Month (Auto-calculated)</label>
                        <input type="text" class="form-control" id="salary_per_month" readonly>
                    </div>
                    
                    <div class="mb-3">
                        <label for="client_consultancy" class="form-label">Client/Consultancy Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="client_consultancy" name="client_consultancy" required>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="is_new_employee" name="is_new_employee">
                            <label class="form-check-label" for="is_new_employee">
                                New Employee
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="date_of_joining" class="form-label">Date of Joining</label>
                        <input type="date" class="form-control" id="date_of_joining" name="date_of_joining">
                        <small class="form-text text-muted">Required if marked as new employee</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="salary_date" class="form-label">Salary Date (Day of Month)</label>
                        <input type="number" class="form-control" id="salary_date" name="salary_date" 
                               min="1" max="31" value="10" required>
                        <small class="form-text text-muted">Default is 10th of every month</small>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('employees.list_employees') }}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Add Employee</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">All Employees</h5>
            </div>
            <div class="card-body">
                {% if employees %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Salary per Annum</th>
                                <th>Salary per Month</th>
                                <th>Client/Consultancy</th>
                                <th>New Employee</th>
                                <th>Date of Joining</th>
                                <th>Salary Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for employee in employees %}
                            <tr>
                                <td>{{ employee.id }}</td>
                                <td>{{ employee.name }}</td>
                                <td>INR {{ "{:,.2f}".format(employee.salary_per_annum) }}</td>
                                <td>INR {{ "{:,.2f}".format(employee.salary_per_month) }}</td>
                                <td>{{ employee.client_consultancy }}</td>
                                <td>
                                    {% if employee.is_new_employee %}
                                        <span class="badge bg-success">Yes</span>
                                    {% else %}
                                        <span class="badge bg-secondary">No</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if employee.date_of_joining %}
                                        {{ employee.date_of_joining.strftime('%Y-%m-%d') }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>{{ employee.salary_date }}th</td>
                                <td>
                                    <form method="POST" action="{{ url_for('employees.delete_employee', employee_id=employee.id) }}" 
                                          onsubmit="return confirm('Are you sure you want to delete this employee?');" 
                                          class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    No employees found. <a href="{{ url_for('employees.add_employee') }}">Add your first employee</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const salaryPerAnnum = document.getElementById('salary_per_annum');
        const salaryPerMonth = document.getElementById('salary_per_month');
        
        if (salaryPerAnnum && salaryPerMonth) {
            salaryPerAnnum.addEventListener('input', function() {
                const annual = parseFloat(this.value) || 0;
                const monthly = annual / 12;
                salaryPerMonth.value = monthly.toFixed(2);
            });
        }
        
        // Handle new employee checkbox and date of joining
        const isNewEmployee = document.getElementById('is_new_employee');
        const dateOfJoining = document.getElementById('date_of_joining');
        
        if (isNewEmployee && dateOfJoining) {
            isNewEmployee.addEventListener('change', function() {
                if (this.checked) {
                    dateOfJoining.setAttribute('required', 'required');
                    dateOfJoining.parentElement.querySelector('small').textContent = 'Required for new employees';
                } else {
                    dateOfJoining.removeAttribute('required');
                    dateOfJoining.parentElement.querySelector('small').textContent = 'Required if marked as new employee';
                }
            });
        }
    });
</script>
{% endblock %}

